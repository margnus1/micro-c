\documentclass[a4paper,11pt]{article}

%% We can use macros to avoid typing the same thing over and over
\newcommand{\token}[1]{\texttt{<#1>}}
\newcommand{\uC}{{$\mathrm{\mu}$}C }
 \usepackage{tikz}
 \usepackage{tikz-qtree}
 \usepackage{array}
\usepackage{amsmath}
\usepackage{multicol}
\usepackage{listings}
\usepackage{alltt}
\usepackage{hyperref}
\usepackage[lighttt]{lmodern}

%% Simple syntax highlighting for our RTL. Add more keywords here.
\lstset{keywords={Procedure, ADD, SUB, MUL, DIV, LTEQ, LT, EQ, NE, GTEQ, GT,
    Mov, Not, Neg, Jump, Branch, Zero, NonZero, IntConst, GlobalAddress, Store,
    Load, BYTE, INT, Call, ArrayAddress}}

\title{Assignment 4: ICode Generation \\
       Compiler Design Project, 1DL420}
\author{Xiao Yang \and Magnus L{\aa}ng}
\date{\today}
\begin{document}
\maketitle

\section{RTL Design Rationale}
\begin{itemize}
  \item Why flat datatypes?
  \item Why no distinction between locals and temporaries?
  \item Why having regs $1,\, \dots,\, n$ be the $n$ formals?
  \item Why \texttt{\textbf{ArrayAddress}} instead of \texttt{FP}?
\end{itemize}

\newpage
\appendix
\renewcommand\thesection{Appendix \Alph{section}} %% Add the word ``Appendix'' to the numbering

\section{RTL Documentation}
This documentation is also distributed with the source code, in the
\path{doc/RTL.md} file.
%% TODO: convert (preferably automatically) our RTL doc to LaTeX and paste it
%% here with \include or \input or \subfile

\section{Sample RTL for Test Files}
\subsection{\texttt{quiet/lexer/l05.c}}
\begin{lstlisting}
Procedure main
  Argument count: 0
  Stack frame size: 0
  Register types:
    RV: INT
    r1: INT
    r2: INT
    r3: INT
    r4: INT
    r5: INT
    r6: INT
    r7: INT
    r8: INT
    r9: INT
    r10: INT
    r11: INT
    r12: INT
    r13: INT
    r14: INT
    r15: INT
    r16: INT
    r17: INT
    r18: INT
    r19: INT
    r20: INT
    r21: INT
    r22: INT
    r23: INT
    r24: INT
    r25: INT
    r26: INT
    r27: INT
    r28: INT
    r29: INT
    r30: INT
    r31: INT
    r32: INT
  Instructions:
      r3 <- IntConst 1
      r4 <- IntConst 3
      r4 <- Not r4
      r2 <- NE r3, r4
      r6 <- IntConst 4
      r5 <- Mov r6
      Branch main.andshortcircut, NonZero, r5
      r7 <- IntConst 6
      r5 <- Mov r7
    main.andshortcircut:
      r10 <- IntConst 7
      r11 <- IntConst 8
      r9 <- MUL r10, r11
      r12 <- IntConst 10
      r8 <- ADD r9, r12
      r15 <- IntConst 11
      r16 <- IntConst 12
      r14 <- SUB r15, r16
      r18 <- IntConst 12
      r19 <- IntConst 16
      r17 <- DIV r18, r19
      r13 <- ADD r14, r17
      r22 <- IntConst 17
      r23 <- IntConst 18
      r21 <- LTEQ r22, r23
      r24 <- IntConst 20
      r24 <- Neg r24
      r20 <- LT r21, r24
      r26 <- IntConst 21
      r27 <- IntConst 22
      r25 <- EQ r26, r27
      r1 <- Mov r25
      r30 <- IntConst 25
      r31 <- IntConst 27
      r29 <- GTEQ r30, r31
      r32 <- IntConst 28
      r28 <- GT r29, r32
    main.exit:
\end{lstlisting}

\subsection{\texttt{quiet/rtl/r01.c}}
\begin{lstlisting}
y: 1
x: 4
Procedure main
  Argument count: 0
  Stack frame size: 0
  Register types:
    RV: INT
    r1: INT
    r2: BYTE
    r3: INT
    r4: INT
    r5: INT
    r6: INT
    r7: INT
    r8: INT
  Instructions:
      r3 <- IntConst 42
      r4 <- GlobalAddress x
      r4 <- Store INT r3
      r5 <- IntConst 43
      r6 <- GlobalAddress y
      r6 <- Store BYTE r5
      r7 <- IntConst 65
      r1 <- Mov r7
      r8 <- IntConst 10
      r2 <- Mov r8
    main.exit:
\end{lstlisting}

\subsection{\texttt{quiet/rtl/r02.c}}
\begin{lstlisting}
Procedure f
  Argument count: 2
  Stack frame size: 0
  Register types:
    RV: INT
    r1: INT
    r2: INT
    r3: INT
  Instructions:
      r3 <- ADD r1, r2
      RV <- Mov r3
      Jump f.exit
    f.exit:
Procedure main
  Argument count: 0
  Stack frame size: 0
  Register types:
    RV: INT
    r1: INT
    r2: INT
    r3: INT
  Instructions:
      r1 <- IntConst 2
      r2 <- IntConst 3
      r3 <- Call f r1, r2
    main.exit:
\end{lstlisting}

\subsection{\texttt{quiet/rtl/r03.c}}
\begin{lstlisting}
a: 40
Procedure main
  Argument count: 0
  Stack frame size: 12
  Register types:
    RV: INT
    r1: INT
    r2: INT
    r3: INT
    r4: INT
    r5: INT
    r6: INT
    r7: INT
    r8: INT
    r9: INT
    r10: INT
    r11: INT
    r12: INT
    r13: INT
    r14: INT
    r15: INT
    r16: INT
  Instructions:
      r2 <- GlobalAddress a
      r3 <- IntConst 5
      r4 <- IntConst 4
      r4 <- MUL r4, r3
      r4 <- ADD r4, r2
      r4 <- Load INT r4
      r5 <- IntConst 7
      r1 <- ADD r4, r5
      r6 <- GlobalAddress a
      r7 <- IntConst 3
      r8 <- IntConst 4
      r8 <- MUL r8, r7
      r8 <- ADD r8, r6
      r8 <- Store INT r1
      r10 <- ArrayAddress 0
      r11 <- IntConst 5
      r12 <- IntConst 1
      r12 <- MUL r12, r11
      r12 <- ADD r12, r10
      r12 <- Load BYTE r12
      r13 <- IntConst 7
      r9 <- ADD r12, r13
      r14 <- ArrayAddress 0
      r15 <- IntConst 3
      r16 <- IntConst 1
      r16 <- MUL r16, r15
      r16 <- ADD r16, r14
      r16 <- Store BYTE r9
    main.exit:
\end{lstlisting}

\subsection{\texttt{quiet/rtl/r04.c}}
\begin{lstlisting}
Procedure f
  Argument count: 1
  Stack frame size: 0
  Register types:
    RV: INT
    r1: INT
  Instructions:
    f.exit:
Procedure main
  Argument count: 0
  Stack frame size: 8
  Register types:
    RV: INT
    r1: INT
  Instructions:
      r1 <- ArrayAddress 0
      Call f r1
    main.exit:
\end{lstlisting}

\subsection{\texttt{quiet/rtl/r05.c}}
\begin{lstlisting}
a: 40
Procedure f
  Argument count: 1
  Stack frame size: 0
  Register types:
    RV: INT
    r1: INT
    r2: INT
    r3: INT
    r4: INT
    r5: INT
    r6: INT
    r7: INT
  Instructions:
      r3 <- IntConst 5
      r4 <- IntConst 4
      r4 <- MUL r4, r3
      r4 <- ADD r4, r1
      r4 <- Load INT r4
      r5 <- IntConst 7
      r2 <- ADD r4, r5
      r6 <- IntConst 3
      r7 <- IntConst 4
      r7 <- MUL r7, r6
      r7 <- ADD r7, r1
      r7 <- Store INT r2
    f.exit:
Procedure main
  Argument count: 0
  Stack frame size: 0
  Register types:
    RV: INT
    r1: INT
  Instructions:
      r1 <- GlobalAddress a
      Call f r1
    main.exit:
\end{lstlisting}

\end{document}
